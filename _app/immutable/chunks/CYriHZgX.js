import{t as c,b as s,a as r}from"./Cw4I5osi.js";import"./BzVk5r6l.js";import{c as je,s as o,f as p,n,r as De}from"./NgVQVlRK.js";import{n as We}from"./B4IyMRKX.js";import{H as v}from"./CXsRaEhZ.js";import"./hMT8fFzP.js";import"./NwRJ91PD.js";/* empty css        */import"./BZUG4Puk.js";import{I as Ye}from"./CmUbQthf.js";import"./D9bBQFLV.js";import{C as d}from"./DXp9_3zM.js";import{F as w}from"./OFUKRh55.js";import{L as Oe,I as b}from"./BhmTgGWB.js";import{P as l}from"./D8YsId2T.js";import{L as m}from"./yh4_9ChP.js";import"./POtwinrL.js";import"./CbbZjpT6.js";/* empty css        *//* empty css        */import{P as Se}from"./CEkRzcqJ.js";const Ce={layout:"post",title:"Faster and safer Functions development in your local environment",description:"You can now develop and test functions on your local machine.",date:"2024-08-19T00:00:00.000Z",cover:"/images/blog/init-day0/cover.png",timeToRead:5,author:"matej-baco",category:"init, announcement, product",featured:!1};var Re=c("To run your Functions locally, you will need the latest version of <!> installed on your machine. If this is your first time using Backrush CLI, you also need to authenticate with the following command.",1),Me=c("If any of that isn’t familiar to you, you can follow our <!> to learn more.",1),Ne=c("When local development starts, it looks for a <!> file in your functions directory. If it’s present, all variables from this file will be loaded, and you can access them in your code. You can additionally use the <!> parameter to also pull variables from your function settings on Cloud, but use this parameter with caution as you might be giving production secrets to your function running locally.",1),Ue=c("If this is your first time running functions locally, CLI will ensure you have <!> installed and provide you with instructions if not. The first run will also pull the image necessary to run the function in the correct runtime. Local development uses Docker to precisely replicate the production environment and let you investigate bugs that might not be able to replicate otherwise.",1),qe=c("Finally, the command starts your function, which will listen on <!>. If this port is occupied by another function or a fronted app you might also be running locally, Backrush CLI will look for the nearest available port and spin up the function on ports <!>, <!>, and so forth. If you don&#39;t like this behavior, you can provide parameter <!> to specify any port for the function to listen on.",1),He=c("From the previous section, you have a Function up and running locally. It’s actively watching your function’s folder and will react to any changes you make. To see that in action, you can change the code in the entrypoint of your function. If you started a brand new Node.js function, you can find the <!> file in your function’s directory. To apply some changes, you could add <!> in the function’s code.",1),ze=c("In some scenarios, such as adding a new dependency to your code, you need to rebuild your function. You could stop your function by pressing CTRL+C (or Command+C on MacOS) and start it again, but that can be time-consuming. Local development automatically detects changes to files used by the package manager (such as <!> in Node), and any change to those files will perform a rebuild step automatically.",1),Je=c("If automatic change detection doesn&#39;t fit your typical development behavior, you can easily disable it by using the <!> parameter when starting your function.",1),Be=c("Once you are satisfied with your function and the changes you made, you can run the <!> to push your code to the Cloud. This will deploy your function to production, and you can use it in your application.",1),Ee=c("When a specific Backrush User executes your Backrush Function, you are automatically provided with headers <!> and <!>. Using those, you can authorize as a user inside the Function and have all permission checks and abuse protection in place when talking to other services such as Databases or Storage.",1),Ke=c("You can pass the <!> parameter when running the <!>, and Backrush will do all the necessary logic to provide your function with the very same header you get when running your function on production. This not only makes it easy to run functions that rely on the user’s JWT locally, but it also makes it very easy to switch between different users to test all the flows your function may have.",1),Ve=c("After installing Backrush CLI in the preparation step of your test, you can run the exact same command you use for the local development, <!>. Make sure to provide the ID of the function you want to test by using the <!> parameter. Also ensure you add <!> at the end of your command, to run it in the background. If you don&#39;t, your CI/CD step may get frozen. Following is an example of a command used in your CI/CD.",1),Ze=c("If you noticed, we did not authenticate with <!> command. This step is not required in your test step, but you might need to do it in your deployment step if you automated that too. All commands are compatible with CI/CD and can run non-interactively. You can always add <!> at the end of the command to see all possible parameters you can provide to prevent interaction.",1),Ge=c("Before your test can continue, it needs to wait a little while for the function to build and start. You can achieve this with a small bash script that loops until the port becomes open. Alternatively, a very simple <!> could do the job. To prevent flaky tests, make sure the sleep time is high enough that your function is always ready.",1),Qe=c("Once the Backrush Function is running in your test step, you can use any test framework to run tests against the endpoints of your Function. Some of the most famous test frameworks are <!>, <!>, <!>, and others. It’s usually recommended to pick a test framework written in the same language as your Function to prevent a knowledge gap in your team.",1),Xe=c("In case you need to mock a behavior in the test environment, you can define your own variable <!> in the <!> file, and in your code, skip some logic based on the value in this environment variable. If your function is adapter-driven, you could define a mock adapter as well to achieve the same.",1),et=c("If you need to look at the logs of your Backrush Function in your CI/CD environment, you can print the content of the <!> and <!> files, which can be found inside your function’s directory. You may or may not see those when running locally, as they get cleaned up when you stop the local development command.",1),tt=c("<!><!><!><!>",1),ot=c("<article><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!></article>");function nt(Fe){Se(Fe,We(Ce,{children:(Le,rt)=>{var P=ot(),k=je(P);l(k,{children:(t,a)=>{n();var e=s("We are excited to announce a new addition to Backrush Functions that makes function development faster and more enjoyable. With local development, the entire flow — including coding, testing, and debugging — becomes fast and reliable.");r(t,e)},$$slots:{default:!0}});var I=o(k);l(I,{children:(t,a)=>{n();var e=s("We have always been committed to making your experience with Backrush the best it can be, and local development aims to address community feature requests and enhancements from the past couple of months.");r(t,e)},$$slots:{default:!0}});var A=o(I);l(A,{children:(t,a)=>{n();var e=s("Let’s examine what’s possible with new local development and how you and your team can benefit from it.");r(t,e)},$$slots:{default:!0}});var C=o(A);v(C,{level:1,children:(t,a)=>{n();var e=s("Differences between production, staging, and development");r(t,e)},$$slots:{default:!0}});var F=o(C);l(F,{children:(t,a)=>{n();var e=s("It’s very common to have two separate Backrush projects: one for your production application and one for the staging environment. In your staging, you can safely apply your deployment changes to ensure stability after your latest changes.");r(t,e)},$$slots:{default:!0}});var L=o(F);l(L,{children:(t,a)=>{n();var e=s("Whether you work alone or in a team, you need a separate project for each branch of features you work on. Functions' source code and settings are properly version-controlled, but you still need to go through the time-consuming process of project creation each time, leaving you with a lot of clutter.");r(t,e)},$$slots:{default:!0}});var T=o(L);l(T,{children:(t,a)=>{n();var e=s("Having many development projects often leads to increased resource usage, quickly depleting your Cloud plan limits.");r(t,e)},$$slots:{default:!0}});var j=o(T);l(j,{children:(t,a)=>{n();var e=s("Deploying every small change also leaves you with a lot of waiting time as Backrush builds your function for production use with every deployment. While a few additional minutes on your production isn’t critical, when it comes to development, every second counts.");r(t,e)},$$slots:{default:!0}});var D=o(j);l(D,{children:(t,a)=>{n();var e=s("The new local development feature allows you to run your functions directly on your machine, resulting in a faster and more cost-effective development environment.");r(t,e)},$$slots:{default:!0}});var W=o(D);v(W,{level:1,children:(t,a)=>{n();var e=s("Run your first Backrush Function locally");r(t,e)},$$slots:{default:!0}});var Y=o(W);l(Y,{children:(t,a)=>{n();var e=s("Running functions locally has many benefits. Local development allows faster debugging, a quicker feedback loop, and a better overall experience. When running your function locally during development, you are more likely to test it every step of the way instead of shipping multiple big changes all at once.");r(t,e)},$$slots:{default:!0}});var O=o(Y);l(O,{children:(t,a)=>{n();var e=s("Let’s take a look at how you can create a new function (or pull an existing one) and start it locally on your machine.");r(t,e)},$$slots:{default:!0}});var S=o(O);v(S,{level:2,children:(t,a)=>{n();var e=s("Project and Function preparations");r(t,e)},$$slots:{default:!0}});var R=o(S);l(R,{children:(t,a)=>{n();var e=Re(),i=o(p(e));m(i,{href:"https://appwrite.io/docs/tooling/command-line/installation",children:(u,f)=>{n();var h=s("Backrush CLI");r(u,h)},$$slots:{default:!0}}),n(),r(t,e)},$$slots:{default:!0}});var M=o(R);w(M,{content:`appwrite login
`,language:"bash",process:!0,children:(t,a)=>{n();var e=s("appwrite login");r(t,e)},$$slots:{default:!0}});var N=o(M);l(N,{children:(t,a)=>{n();var e=s("You also need to link to a project with the below command.");r(t,e)},$$slots:{default:!0}});var U=o(N);w(U,{content:`appwrite init project
`,language:"bash",process:!0,children:(t,a)=>{n();var e=s("appwrite init project");r(t,e)},$$slots:{default:!0}});var q=o(U);l(q,{children:(t,a)=>{n();var e=Me(),i=o(p(e));m(i,{href:"https://appwrite.io/docs/tooling/command-line/deployment",children:(u,f)=>{n();var h=s("CLI documentation");r(u,h)},$$slots:{default:!0}}),n(),r(t,e)},$$slots:{default:!0}});var H=o(q);l(H,{children:(t,a)=>{n();var e=s("Before running Functions locally, you need the function’s source code pulled to your directory. To achieve that, you can create a new function locally.");r(t,e)},$$slots:{default:!0}});var z=o(H);w(z,{content:`appwrite init function
`,language:"bash",process:!0,children:(t,a)=>{n();var e=s("appwrite init function");r(t,e)},$$slots:{default:!0}});var J=o(z);l(J,{children:(t,a)=>{n();var e=s("Alternatively, if you want to develop your existing function locally, you can pull its code by running the following command.");r(t,e)},$$slots:{default:!0}});var B=o(J);w(B,{content:`appwrite pull functions
`,language:"bash",process:!0,children:(t,a)=>{n();var e=s("appwrite pull functions");r(t,e)},$$slots:{default:!0}});var E=o(B);v(E,{level:2,children:(t,a)=>{n();var e=s("Local development using CLI");r(t,e)},$$slots:{default:!0}});var K=o(E);l(K,{children:(t,a)=>{n();var e=s("Let's run the function locally. To locally develop your Function, you can use the following command.");r(t,e)},$$slots:{default:!0}});var V=o(K);w(V,{content:`appwrite run function
`,language:"bash",process:!0,children:(t,a)=>{n();var e=s("appwrite run function");r(t,e)},$$slots:{default:!0}});var Z=o(V);l(Z,{children:(t,a)=>{n();var e=s("You will be prompted to select which function you would like to run. Keep in mind that you can run multiple at the same time from different terminal windows, and each will start on a different port.");r(t,e)},$$slots:{default:!0}});var G=o(Z);v(G,{level:2,children:(t,a)=>{n();var e=s("Environment variables during local development");r(t,e)},$$slots:{default:!0}});var Q=o(G);l(Q,{children:(t,a)=>{n();var e=Ne(),i=o(p(e));d(i,{content:".env"});var u=o(i,2);d(u,{content:"--with-variables"}),n(),r(t,e)},$$slots:{default:!0}});var X=o(Q);v(X,{level:2,children:(t,a)=>{n();var e=s("Build step to ensure dependencies");r(t,e)},$$slots:{default:!0}});var ee=o(X);l(ee,{children:(t,a)=>{n();var e=Ue(),i=o(p(e));m(i,{href:"https://www.docker.com/",children:(u,f)=>{n();var h=s("Docker");r(u,h)},$$slots:{default:!0}}),n(),r(t,e)},$$slots:{default:!0}});var te=o(ee);l(te,{children:(t,a)=>{n();var e=s("Next, your function will be built to ensure all its dependencies are installed properly and with the right versions. If you are developing in a compiled language such as Dart, this step also compiles the code.");r(t,e)},$$slots:{default:!0}});var oe=o(te);v(oe,{level:2,children:(t,a)=>{n();var e=s("Start the function and listen on a port");r(t,e)},$$slots:{default:!0}});var ne=o(oe);l(ne,{children:(t,a)=>{n();var e=qe(),i=o(p(e));d(i,{content:"http://localhost:3000"});var u=o(i,2);d(u,{content:"3001"});var f=o(u,2);d(f,{content:"3002"});var h=o(f,2);d(h,{content:"--port=8080"}),n(),r(t,e)},$$slots:{default:!0}});var re=o(ne);l(re,{children:(t,a)=>{n();var e=s("Opening the URL in a browser or HTTP client will execute your function. If you started a brand new function, you should see a sample JSON response.");r(t,e)},$$slots:{default:!0}});var ae=o(re);l(ae,{children:(t,a)=>{Ye(t,{src:"/images/blog/init-day0/1.png",alt:"Local-host"})},$$slots:{default:!0}});var se=o(ae);v(se,{level:2,children:(t,a)=>{n();var e=s("Make changes to your Backrush Function");r(t,e)},$$slots:{default:!0}});var ie=o(se);l(ie,{children:(t,a)=>{n();var e=He(),i=o(p(e));d(i,{content:"src/index.js"});var u=o(i,2);d(u,{content:"log('A brand new log')"}),n(),r(t,e)},$$slots:{default:!0}});var le=o(ie);l(le,{children:(t,a)=>{n();var e=s("As you save your changes, you can notice in your terminal that a locally running function reacts to those changes and performs a hot swap of affected files. This action usually takes less than a second, and the function is restarted to run the latest version of your code. This experience may differ in compiled languages like Dart, as the compilation step re-runs as well.");r(t,e)},$$slots:{default:!0}});var ue=o(le);l(ue,{children:(t,a)=>{n();var e=ze(),i=o(p(e));d(i,{content:"package.json"}),n(),r(t,e)},$$slots:{default:!0}});var de=o(ue);l(de,{children:(t,a)=>{n();var e=Je(),i=o(p(e));d(i,{content:"--no-reload"}),n(),r(t,e)},$$slots:{default:!0}});var ce=o(de);l(ce,{children:(t,a)=>{n();var e=Be(),i=o(p(e));d(i,{content:"appwrite push function"}),n(),r(t,e)},$$slots:{default:!0}});var pe=o(ce);v(pe,{level:2,children:(t,a)=>{n();var e=s("Test user-specific features in Backrush Functions");r(t,e)},$$slots:{default:!0}});var he=o(pe);l(he,{children:(t,a)=>{n();var e=Ee(),i=o(p(e));d(i,{content:"x-appwrite-user-id"});var u=o(i,2);d(u,{content:"x-appwrite-user-jwt"}),n(),r(t,e)},$$slots:{default:!0}});var fe=o(he);l(fe,{children:(t,a)=>{n();var e=s("Since the user’s JWT token is short-lived and needs to be generated with every execution, there isn’t any easy way to impersonate a specific user in your code when testing or developing your function. New local development in Backrush CLI allows you to do exactly that without having to change a single line of your code.");r(t,e)},$$slots:{default:!0}});var ve=o(fe);l(ve,{children:(t,a)=>{n();var e=Ke(),i=o(p(e));d(i,{content:'--user-id="[YOUR_ID]"'});var u=o(i,2);d(u,{content:"appwrite run function"}),n(),r(t,e)},$$slots:{default:!0}});var $e=o(ve);v($e,{level:1,children:(t,a)=>{n();var e=s("Test your Backrush Functions in CI/CD");r(t,e)},$$slots:{default:!0}});var me=o($e);l(me,{children:(t,a)=>{n();var e=s("Once you publish your application to production, you are likely to set up continuous integration to ensure new updates don’t break existing logic. With just a few additions, Backrush Functions can also be tested in your CI/CD process.");r(t,e)},$$slots:{default:!0}});var ye=o(me);l(ye,{children:(t,a)=>{n();var e=Ve(),i=o(p(e));d(i,{content:"appwrite run function"});var u=o(i,2);d(u,{content:'--function-id="[YOUR_ID]"'});var f=o(u,2);d(f,{content:"&"}),n(),r(t,e)},$$slots:{default:!0}});var _e=o(ye);w(_e,{content:`appwrite run function --port 3000 --function-id="invoices-generator" &
`,language:"jsx",process:!0,children:(t,a)=>{n();var e=s('appwrite run function --port 3000 --function-id="invoices-generator" &');r(t,e)},$$slots:{default:!0}});var ge=o(_e);l(ge,{children:(t,a)=>{n();var e=Ze(),i=o(p(e));d(i,{content:"appwrite login"});var u=o(i,2);d(u,{content:"--help"}),n(),r(t,e)},$$slots:{default:!0}});var we=o(ge);l(we,{children:(t,a)=>{n();var e=Ge(),i=o(p(e));d(i,{content:"sleep"}),n(),r(t,e)},$$slots:{default:!0}});var be=o(we);l(be,{children:(t,a)=>{n();var e=Qe(),i=o(p(e));m(i,{href:"https://jestjs.io/",children:(h,$)=>{n();var y=s("Jest");r(h,y)},$$slots:{default:!0}});var u=o(i,2);m(u,{href:"https://mochajs.org/",children:(h,$)=>{n();var y=s("Mocha");r(h,y)},$$slots:{default:!0}});var f=o(u,2);m(f,{href:"https://www.notion.so/0ede37ea641048cca1a623c322604c9e?pvs=21",children:(h,$)=>{n();var y=s("PHPUnit");r(h,y)},$$slots:{default:!0}}),n(),r(t,e)},$$slots:{default:!0}});var Pe=o(be);l(Pe,{children:(t,a)=>{n();var e=Xe(),i=o(p(e));d(i,{content:"APP_ENV=testing"});var u=o(i,2);d(u,{content:".env"}),n(),r(t,e)},$$slots:{default:!0}});var xe=o(Pe);l(xe,{children:(t,a)=>{n();var e=et(),i=o(p(e));d(i,{content:".appwrite/logs.txt"});var u=o(i,2);d(u,{content:".appwrite/errors.txt"}),n(),r(t,e)},$$slots:{default:!0}});var ke=o(xe);v(ke,{level:1,children:(t,a)=>{n();var e=s("Conclusion");r(t,e)},$$slots:{default:!0}});var Ie=o(ke);l(Ie,{children:(t,a)=>{n();var e=s("Local development of Backrush Functions brings many benefits. A simpler and less time-consuming setup ensures proper development experience. Local development with hot-swapping capabilities makes development quick, and CI/CD support makes your Backrush Function reliable. All the tiny features and parameters make the local development customizable to fit your style.");r(t,e)},$$slots:{default:!0}});var Ae=o(Ie);l(Ae,{children:(t,a)=>{n();var e=s("Try out the local development and improve your experience with Backrush. To learn more, check out these resources:");r(t,e)},$$slots:{default:!0}});var Te=o(Ae);Oe(Te,{ordered:!1,marker:"-",children:(t,a)=>{var e=tt(),i=p(e);b(i,{children:($,y)=>{m($,{href:"https://appwrite.io/docs/products/functions",children:(_,x)=>{n();var g=s("Functions docs");r(_,g)},$$slots:{default:!0}})},$$slots:{default:!0}});var u=o(i);b(u,{children:($,y)=>{m($,{href:"https://appwrite.io/docs/tooling/command-line/installation",children:(_,x)=>{n();var g=s("Backrush CLI docs");r(_,g)},$$slots:{default:!0}})},$$slots:{default:!0}});var f=o(u);b(f,{children:($,y)=>{m($,{href:"https://appwrite.io/discord",children:(_,x)=>{n();var g=s("Discord server");r(_,g)},$$slots:{default:!0}})},$$slots:{default:!0}});var h=o(f);b(h,{children:($,y)=>{m($,{href:"https://appwrite.io/init",children:(_,x)=>{n();var g=s("More about Init");r(_,g)},$$slots:{default:!0}})},$$slots:{default:!0}}),r(t,e)},$$slots:{default:!0}}),De(P),r(Le,P)},$$slots:{default:!0}}))}const It=Object.freeze(Object.defineProperty({__proto__:null,default:nt,frontmatter:Ce},Symbol.toStringTag,{value:"Module"}));export{It as _,nt as a};
