import{t as p,b as a,a as s}from"./Cw4I5osi.js";import"./BzVk5r6l.js";import{s as o,f as $,c as he,n as r,r as ve}from"./NgVQVlRK.js";import{n as fe}from"./B4IyMRKX.js";import{H as _}from"./CXsRaEhZ.js";import"./hMT8fFzP.js";import"./NwRJ91PD.js";/* empty css        */import"./BZUG4Puk.js";/* empty css        */import"./D9bBQFLV.js";import{C as f}from"./DXp9_3zM.js";import{F as k}from"./OFUKRh55.js";import{L as P,I as m}from"./BhmTgGWB.js";import{P as d}from"./D8YsId2T.js";import{S as A}from"./yHjwcyUH.js";import{L as w}from"./yh4_9ChP.js";import"./POtwinrL.js";import"./CbbZjpT6.js";/* empty css        */import{P as me}from"./CEkRzcqJ.js";const de={layout:"post",title:"Error: User (role: guests) missing scope (account) - What it means and how to fix it",description:"Understanding and resolving a common authentication error in Backrush.",date:"2025-03-07T00:00:00.000Z",cover:"/images/blog/user-role-guests-missing-scope-account/cover.png",timeToRead:5,author:"ebenezer-don",category:"debugging"};var _e=p("If you&#39;ve been working with Backrush, you&#39;ve likely encountered the error message <!> at some point. This error is one of the most common questions we see from developers, especially those new to Backrush. In this post, we&#39;ll break down what this error means and walk through the various scenarios where it might appear, along with their solutions.",1),ge=p("<!>: This indicates that the request is coming from an unauthenticated user (a guest) rather than a logged-in user.",1),we=p("<!>: This means the operation you&#39;re trying to perform requires access to an account.",1),ye=p("<!><!>",1),Pe=p("If you&#39;re not logged in yet and you try to get information about the user with something like <!>, you&#39;ll see this error.",1),xe=p("However, if you&#39;re getting this error when you actually need an authenticated session, simply create a session before calling <!>:",1),be=p("A more complex scenario occurs when using OAuth2 authentication in web applications. When you use <!> in a web app, a cookie is set for the session.",1),ke=p("If your app and Backrush endpoint are on different domains (for example, your app is on <!> and you&#39;re using <!> as your Backrush endpoint), the cookie may not be included in the <!> request because the cookie is considered a 3rd party cookie.",1),Ae=p("When moving to production, configure a <!> for your Backrush project so that cookies are sent from the same domain as your application. This ensures that session cookies are properly sent with each request.",1),Se=p("Another approach is to use Backrush&#39;s OAuth2 token-based authentication, which bypasses third-party cookie restrictions entirely. Instead of <!>, you would use <!> which uses local storage as a fallback where cookies won&#39;t work.",1),Te=p("For a detailed implementation guide, check out this article on <!>, which covers this approach in detail.",1),Fe=p("Since <!> doesn&#39;t persist a session, calling <!> right after will result in an unauthenticated request:",1),qe=p("<!><!>",1),Ie=p("For detailed implementation examples and best practices for server-side rendering with Backrush, check out the <!>.",1),Oe=p("<!><!><!>",1),Ee=p("If you&#39;re still running into issues, the Backrush <!> is always available to help.",1),Ue=p("<!><!><!>",1),je=p("<article><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!><!></article>");function Ce(ce){me(ce,fe(de,{children:(pe,Le)=>{var x=je(),S=he(x);d(S,{children:(t,n)=>{r();var e=_e(),i=o($(e));A(i,{marker:"**",children:(l,c)=>{r();var u=a('"Error: User (role: guests) missing scope (account)"');s(l,u)},$$slots:{default:!0}}),r(),s(t,e)},$$slots:{default:!0}});var T=o(S);_(T,{level:1,children:(t,n)=>{r();var e=a("Understanding the error message");s(t,e)},$$slots:{default:!0}});var F=o(T);d(F,{children:(t,n)=>{r();var e=a("Before diving into specific scenarios, let's understand what the error message is telling us:");s(t,e)},$$slots:{default:!0}});var q=o(F);P(q,{ordered:!1,marker:"-",children:(t,n)=>{var e=ye(),i=$(e);m(i,{children:(c,u)=>{var h=ge(),v=$(h);A(v,{marker:"**",children:(y,g)=>{r();var b=a("User (role: guests)");s(y,b)},$$slots:{default:!0}}),r(),s(c,h)},$$slots:{default:!0}});var l=o(i);m(l,{children:(c,u)=>{var h=we(),v=$(h);A(v,{marker:"**",children:(y,g)=>{r();var b=a("missing scope (account)");s(y,b)},$$slots:{default:!0}}),r(),s(c,h)},$$slots:{default:!0}}),s(t,e)},$$slots:{default:!0}});var I=o(q);d(I,{children:(t,n)=>{r();var e=a("In essence, this error occurs when you're trying to perform an operation that requires authentication, but Backrush doesn't detect a valid authenticated session.");s(t,e)},$$slots:{default:!0}});var O=o(I);d(O,{children:(t,n)=>{r();var e=a("There are a handful of reasons you may be receiving this error, which we'll explore in detail below.");s(t,e)},$$slots:{default:!0}});var E=o(O);_(E,{level:1,children:(t,n)=>{r();var e=a("No active session");s(t,e)},$$slots:{default:!0}});var U=o(E);d(U,{children:(t,n)=>{r();var e=a("The most common cause of this error is attempting to access user account information when there's no active session.");s(t,e)},$$slots:{default:!0}});var j=o(U);d(j,{children:(t,n)=>{r();var e=Pe(),i=o($(e));f(i,{content:"account.get()"}),r(),s(t,e)},$$slots:{default:!0}});var C=o(j);k(C,{content:`// This will fail if no user is logged in
try {
  const user = await account.get();
  console.log(user);
} catch (error) {
  console.error(error); // Error: User (role: guests) missing scope (account)
}
`,language:"jsx",process:!0,children:(t,n)=>{r();var e=a(`// This will fail if no user is logged in
try {
  const user = await account.get();
  console.log(user);
} catch (error) {
  console.error(error); // Error: User (role: guests) missing scope (account)
}`);s(t,e)},$$slots:{default:!0}});var L=o(C);d(L,{children:(t,n)=>{r();var e=a("This error is actually expected and useful in certain scenarios, such as when your app first starts and you need to check if a user is logged in. You can catch this error to determine that there's no active session and redirect users to a login page.");s(t,e)},$$slots:{default:!0}});var N=o(L);d(N,{children:(t,n)=>{r();var e=xe(),i=o($(e));f(i,{content:"account.get()"}),r(),s(t,e)},$$slots:{default:!0}});var W=o(N);k(W,{content:`// First create a session
await account.createEmailSession('user@example.com', 'password');

// Now this will work
const user = await account.get();
console.log(user);
`,language:"jsx",process:!0,children:(t,n)=>{r();var e=a(`// First create a session
await account.createEmailSession('user@example.com', 'password');

// Now this will work
const user = await account.get();
console.log(user);`);s(t,e)},$$slots:{default:!0}});var B=o(W);_(B,{level:1,children:(t,n)=>{r();var e=a("OAuth2 sessions in web applications");s(t,e)},$$slots:{default:!0}});var H=o(B);d(H,{children:(t,n)=>{r();var e=be(),i=o($(e));f(i,{content:"account.createOAuth2Session()"}),r(),s(t,e)},$$slots:{default:!0}});var z=o(H);d(z,{children:(t,n)=>{r();var e=ke(),i=o($(e));f(i,{content:"localhost:3000"});var l=o(i,2);f(l,{content:"https://cloud.appwrite.io/v1"});var c=o(l,2);f(c,{content:"account.get()"}),r(),s(t,e)},$$slots:{default:!0}});var M=o(z);d(M,{children:(t,n)=>{r();var e=a("There are two approaches to solve this issue:");s(t,e)},$$slots:{default:!0}});var R=o(M);_(R,{level:2,children:(t,n)=>{r();var e=a("Option 1: Browser settings and custom domains");s(t,e)},$$slots:{default:!0}});var D=o(R);d(D,{children:(t,n)=>{r();var e=a("For local development, you'll need to allow 3rd party cookies in your browser settings. Many browsers have specific development settings to allow cross-domain cookies during local development.");s(t,e)},$$slots:{default:!0}});var K=o(D);d(K,{children:(t,n)=>{r();var e=Ae(),i=o($(e));w(i,{href:"https://appwrite.io/docs/advanced/platform/custom-domains",children:(l,c)=>{r();var u=a("custom domain");s(l,u)},$$slots:{default:!0}}),r(),s(t,e)},$$slots:{default:!0}});var Y=o(K);_(Y,{level:2,children:(t,n)=>{r();var e=a("Option 2: Use OAuth2 tokens");s(t,e)},$$slots:{default:!0}});var Z=o(Y);d(Z,{children:(t,n)=>{r();var e=Se(),i=o($(e));f(i,{content:"createOAuth2Session()"});var l=o(i,2);f(l,{content:"createOAuth2Token()"}),r(),s(t,e)},$$slots:{default:!0}});var G=o(Z);d(G,{children:(t,n)=>{r();var e=Te(),i=o($(e));w(i,{href:"https://appwrite.io/blog/post/fixing-oauth2-issues-in-appwrite-cloud?doFollow=true",children:(l,c)=>{r();var u=a("Fixing OAuth2 authentication issues in Backrush Cloud");s(l,u)},$$slots:{default:!0}}),r(),s(t,e)},$$slots:{default:!0}});var J=o(G);d(J,{children:(t,n)=>{r();var e=a("Keep in mind that non-public files still require session cookies. If your app needs to handle such files, you'll need to configure a custom domain to ensure cookies are treated as first-party cookies.");s(t,e)},$$slots:{default:!0}});var Q=o(J);_(Q,{level:1,children:(t,n)=>{r();var e=a("Creating sessions server side");s(t,e)},$$slots:{default:!0}});var V=o(Q);d(V,{children:(t,n)=>{r();var e=a("In client-side applications, Backrush automatically persists the session by using cookies. Server-side, however, different frameworks handle sessions differently so the session is not persisted.");s(t,e)},$$slots:{default:!0}});var X=o(V);d(X,{children:(t,n)=>{r();var e=Fe(),i=o($(e));f(i,{content:"account.createEmailPasswordSession()"});var l=o(i,2);f(l,{content:"account.get()"}),r(),s(t,e)},$$slots:{default:!0}});var ee=o(X);k(ee,{content:`// Server-side code - this approach doesn't work as expected
await account.createEmailPasswordSession('user@example.com', 'password');
// In a different request or function call:
const user = await account.get(); // Error: missing scope (account)
`,language:"jsx",process:!0,children:(t,n)=>{r();var e=a(`// Server-side code - this approach doesn't work as expected
await account.createEmailPasswordSession('user@example.com', 'password');
// In a different request or function call:
const user = await account.get(); // Error: missing scope (account)`);s(t,e)},$$slots:{default:!0}});var te=o(ee);d(te,{children:(t,n)=>{r();var e=a("For server-side environments, you need to handle session persistence manually:");s(t,e)},$$slots:{default:!0}});var re=o(te);P(re,{ordered:!0,marker:".",children:(t,n)=>{var e=qe(),i=$(e);m(i,{children:(c,u)=>{r();var h=a("Use an API key when authenticating so that the response from Backrush includes a secret you can use for subsequent requests");s(c,h)},$$slots:{default:!0}});var l=o(i);m(l,{children:(c,u)=>{r();var h=a("Store and reuse the session information between requests");s(c,h)},$$slots:{default:!0}}),s(t,e)},$$slots:{default:!0}});var oe=o(re);d(oe,{children:(t,n)=>{r();var e=Ie(),i=o($(e));w(i,{href:"https://appwrite.io/docs/products/auth/server-side-rendering?doFollow=true",children:(l,c)=>{r();var u=a("SSR documentation");s(l,u)},$$slots:{default:!0}}),r(),s(t,e)},$$slots:{default:!0}});var se=o(oe);_(se,{level:1,children:(t,n)=>{r();var e=a("Conclusion");s(t,e)},$$slots:{default:!0}});var ae=o(se);d(ae,{children:(t,n)=>{r();var e=a('Whenever you see "User (role: guests) missing scope (account)", remember: Backrush expected an authenticated user but received a guest request instead. This typically happens because:');s(t,e)},$$slots:{default:!0}});var ne=o(ae);P(ne,{ordered:!0,marker:".",children:(t,n)=>{var e=Oe(),i=$(e);m(i,{children:(u,h)=>{r();var v=a("No session exists yet");s(u,v)},$$slots:{default:!0}});var l=o(i);m(l,{children:(u,h)=>{r();var v=a("The session cookie is being blocked by browser privacy settings");s(u,v)},$$slots:{default:!0}});var c=o(l);m(c,{children:(u,h)=>{r();var v=a("Server-side code isn't properly managing session persistence");s(u,v)},$$slots:{default:!0}}),s(t,e)},$$slots:{default:!0}});var ie=o(ne);d(ie,{children:(t,n)=>{r();var e=a("Each scenario has a straightforward solution as we've covered above. Test your authentication flow across multiple browsers and environments to ensure it works consistently.");s(t,e)},$$slots:{default:!0}});var le=o(ie);d(le,{children:(t,n)=>{r();var e=Ee(),i=o($(e));w(i,{href:"https://appwrite.io/discord",children:(l,c)=>{r();var u=a("Discord community");s(l,u)},$$slots:{default:!0}}),r(),s(t,e)},$$slots:{default:!0}});var ue=o(le);_(ue,{level:1,children:(t,n)=>{r();var e=a("Further reading");s(t,e)},$$slots:{default:!0}});var $e=o(ue);P($e,{ordered:!1,marker:"-",children:(t,n)=>{var e=Ue(),i=$(e);m(i,{children:(u,h)=>{w(u,{href:"https://appwrite.io/blog/post/building-custom-auth-flows?doFollow=true",children:(v,y)=>{r();var g=a("Building custom authentication flows with Backrush");s(v,g)},$$slots:{default:!0}})},$$slots:{default:!0}});var l=o(i);m(l,{children:(u,h)=>{w(u,{href:"https://appwrite.io/blog/post/fixing-oauth2-issues-in-appwrite-cloud?doFollow=true",children:(v,y)=>{r();var g=a("Fixing OAuth2 authentication issues in Backrush Cloud");s(v,g)},$$slots:{default:!0}})},$$slots:{default:!0}});var c=o(l);m(c,{children:(u,h)=>{w(u,{href:"https://appwrite.io/blog/post/guide-to-user-authentication?doFollow=true",children:(v,y)=>{r();var g=a("A modern developer's guide to user authentication");s(v,g)},$$slots:{default:!0}})},$$slots:{default:!0}}),s(t,e)},$$slots:{default:!0}}),ve(x),s(pe,x)},$$slots:{default:!0}}))}const at=Object.freeze(Object.defineProperty({__proto__:null,default:Ce,frontmatter:de},Symbol.toStringTag,{value:"Module"}));export{at as _,Ce as a};
